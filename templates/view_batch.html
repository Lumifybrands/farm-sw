{% extends "base.html" %}

{% block title %}View Batch - Bismi Farms{% endblock %}

{% block content %}
<!-- Add flatpickr CSS in the head section -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

<style>
/* Modern styling for view batch page */
.content-header {
    background: white;
    padding: 24px 32px;
    border-radius: 12px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    margin-bottom: 24px;
}

.content-header h1 {
    font-size: 24px;
    font-weight: 600;
    color: #1a202c;
    margin: 0 0 8px 0;
}

.breadcrumb {
    color: #718096;
    font-size: 14px;
}

.breadcrumb span:not(:last-child)::after {
    content: "/";
    margin: 0 8px;
    color: #cbd5e0;
}

/* Section tabs styling */
.section-tabs {
    display: flex;
    gap: 12px;
    margin-bottom: 24px;
    overflow-x: auto;
    padding-bottom: 8px;
    -webkit-overflow-scrolling: touch;
}

.section-tab {
    padding: 12px 24px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    cursor: pointer;
    white-space: nowrap;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.section-tab i {
    color: #4299e1;
}

.section-tab.active {
    background: #4299e1;
    color: white;
}

.section-tab.active i {
    color: white;
}

.section-content {
    display: none;
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    padding: 24px;
}

.section-content.active {
    display: block;
}

.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
}

.info-box {
    background: #f8fafc;
    padding: 16px;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
    transition: all 0.2s ease;
}

.info-box:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
}

.info-box .info-label {
    color: #64748b;
    font-size: 14px;
    margin-bottom: 4px;
}

.info-box .info-value {
    color: #1a202c;
    font-size: 16px;
    font-weight: 500;
}

.status-badge {
    display: inline-flex;
    align-items: center;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 500;
}

.status-ongoing {
    background: #ebf8ff;
    color: #2b6cb0;
}

.status-closing {
    background: #fef3c7;
    color: #92400e;
}

.status-closed {
    background: #f0fdf4;
    color: #166534;
}

/* Mobile optimizations */
@media (max-width: 768px) {
    /* Content Header */
    .content-header {
        padding: 16px;
        margin-bottom: 16px;
    }

    .content-header h1 {
        font-size: 20px;
    }

    .breadcrumb {
        font-size: 12px;
    }

    /* Section Tabs */
    .section-tabs {
        padding: 0 8px;
        margin: 0 -8px 16px -8px;
        gap: 8px;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
    }

    .section-tabs::-webkit-scrollbar {
        display: none;
    }

    .section-tab {
        padding: 10px 16px;
        font-size: 13px;
        white-space: nowrap;
    }

    /* Info Grid */
    .info-grid {
        grid-template-columns: 1fr;
        gap: 12px;
    }

    .info-box {
        padding: 12px;
    }

    .info-label {
        font-size: 12px;
    }

    .info-value {
        font-size: 14px;
    }

    /* Financial Summary */
    .financial-summary {
        padding: 16px;
        margin-bottom: 16px;
    }

    .financial-summary .section-title {
        font-size: 18px;
        margin-bottom: 16px;
    }

    .financial-summary .section-subtitle {
        font-size: 16px;
        margin: 20px 0 12px;
    }

    .financial-summary .info-box {
        padding: 12px;
    }

    .financial-summary .info-value {
        font-size: 14px;
    }

    .financial-summary .harvest-details {
        font-size: 13px;
    }

    /* Update Selector */
    .update-selector {
        flex-direction: column;
        padding: 12px;
        gap: 12px;
    }

    .date-picker-container {
        width: 100%;
    }

    .Batch-btn {
        width: 100%;
        justify-content: center;
        padding: 10px;
    }

    /* Update Details */
    .update-header {
        flex-direction: column;
        gap: 12px;
        padding: 12px;
    }

    .update-actions {
        width: 100%;
        flex-wrap: wrap;
        gap: 8px;
    }

    .edit-update-btn, .delete-update-btn {
        flex: 1;
        min-width: 120px;
        justify-content: center;
        padding: 8px 12px;
        font-size: 13px;
    }

    .update-content {
        padding: 16px;
    }

    .info-section-title {
        font-size: 16px;
        margin-bottom: 16px;
    }

    .items-grid {
        grid-template-columns: 1fr;
        gap: 12px;
    }

    .item-card {
        margin-bottom: 12px;
    }

    .item-header {
        padding: 12px;
    }

    .item-details {
        padding: 12px;
    }

    .detail-row {
        padding: 8px 0;
        font-size: 13px;
    }

    /* Fixed Footer */
    .fixed-footer {
        padding: 12px;
        gap: 8px;
        flex-wrap: wrap;
    }

    .fixed-footer .btn {
        flex: 1;
        min-width: 120px;
        padding: 10px;
        font-size: 13px;
    }

    /* Status Modal */
    .modal-content {
        width: 95%;
        margin: 10% auto;
    }

    .modal-header {
        padding: 16px;
    }

    .modal-body {
        padding: 16px;
    }

    .status-options {
        grid-template-columns: 1fr;
        gap: 8px;
    }

    .status-option {
        padding: 12px;
    }

    /* Content Wrapper */
    .content-wrapper {
        padding-bottom: 100px; /* Increased padding for mobile footer */
    }

    /* Alert Messages */
    .alert {
        padding: 12px;
        font-size: 13px;
    }

    /* Priority Badges */
    .priority-badge {
        font-size: 11px;
        padding: 4px 8px;
    }

    /* Item Badges */
    .scheduled-badge, .extra-badge {
        font-size: 11px;
        padding: 4px 8px;
    }

    /* No Updates Message */
    .no-updates {
        padding: 32px 16px;
    }

    .no-updates i {
        font-size: 24px;
    }

    .no-updates p {
        font-size: 14px;
    }
}

/* Additional Mobile Optimizations for Larger Screens */
@media (min-width: 769px) and (max-width: 1024px) {
    .info-grid {
        grid-template-columns: repeat(2, 1fr);
    }

    .items-grid {
        grid-template-columns: repeat(2, 1fr);
    }

    .fixed-footer .btn {
        min-width: 160px;
    }
}

/* Touch Device Optimizations */
@media (hover: none) {
    .info-box:hover,
    .item-card:hover,
    .status-option:hover,
    .btn:hover {
        transform: none;
    }

    .section-tab:active,
    .btn:active,
    .status-option:active {
        opacity: 0.8;
    }
}

/* Add these styles for batch updates */
.update-selector {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 24px;
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.date-picker-container {
    position: relative;
    flex: 1;
}

.date-picker-container input[type="text"] {
    width: 100%;
    padding: 12px 16px;
    padding-right: 40px;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    font-size: 14px;
    color: #2d3748;
    background: white;
    cursor: pointer;
    transition: all 0.2s ease;
}

.date-picker-container input[type="text"]:hover {
    border-color: #4299e1;
}

.date-picker-container input[type="text"]:focus {
    outline: none;
    border-color: #4299e1;
    box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
}

.date-picker-container::after {
    content: '\f073';
    font-family: 'Font Awesome 5 Free';
    font-weight: 900;
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    color: #4299e1;
    pointer-events: none;
}

.Batch-btn {
    padding: 12px 24px;
    background: #4299e1;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.2s ease;
    white-space: nowrap;
}

.Batch-btn:hover {
    background: #3182ce;
    transform: translateY(-1px);
}

.Batch-btn:active {
    transform: translateY(0);
}

.update-details {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    overflow: hidden;
    margin-top: 24px;
}

.update-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 24px;
    background: #f8fafc;
    border-bottom: 1px solid #e2e8f0;
}

.update-date {
    display: flex;
    align-items: center;
    gap: 12px;
    color: #2d3748;
    font-size: 16px;
    font-weight: 500;
}

.update-date i {
    color: #4299e1;
    font-size: 18px;
}

.update-actions {
    display: flex;
    gap: 12px;
}

.edit-update-btn, .delete-update-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
    border: 1px solid transparent;
}

.edit-update-btn {
    background: #ebf8ff;
    color: #2b6cb0;
    border-color: #bee3f8;
}

.edit-update-btn:hover {
    background: #bee3f8;
    transform: translateY(-1px);
}

.delete-update-btn {
    background: #fff5f5;
    color: #c53030;
    border-color: #fed7d7;
}

.delete-update-btn:hover {
    background: #fed7d7;
    transform: translateY(-1px);
}

.update-content {
    padding: 24px;
}

.info-section {
    margin-bottom: 32px;
}

.info-section:last-child {
    margin-bottom: 0;
}

.info-section-title {
    display: flex;
    align-items: center;
    gap: 12px;
    color: #2d3748;
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 2px solid #e2e8f0;
}

.info-section-title i {
    color: #4299e1;
    font-size: 20px;
}

.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 16px;
}

.info-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px;
    background: #f8fafc;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
    transition: all 0.2s ease;
}

.info-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
}

.info-item label {
    color: #64748b;
    font-size: 14px;
    font-weight: 500;
}

.info-item span {
    color: #1a202c;
    font-weight: 600;
    font-size: 15px;
}

.remarks-content {
    background: #f8fafc;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
    color: #2d3748;
    font-size: 14px;
    line-height: 1.6;
    white-space: pre-wrap;
}

.priority-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    margin-left: 12px;
    text-transform: uppercase;
}

.priority-badge.priority-high {
    background: #fff5f5;
    color: #c53030;
    border: 1px solid #fed7d7;
}

.priority-badge.priority-medium {
    background: #fffaf0;
    color: #c05621;
    border: 1px solid #feebc8;
}

.priority-badge.priority-low {
    background: #f0fff4;
    color: #2f855a;
    border: 1px solid #c6f6d5;
}

.category-section {
    margin-top: 32px;
}

.category-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 2px solid #e2e8f0;
}

.category-header i {
    color: #4299e1;
    font-size: 20px;
}

.category-header h4 {
    margin: 0;
    color: #2d3748;
    font-size: 18px;
    font-weight: 600;
}

.items-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 20px;
}

.item-card {
    background: white;
    border-radius: 12px;
    border: 1px solid #e2e8f0;
    overflow: hidden;
    transition: all 0.2s ease;
}

.item-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
}

.item-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    background: #f8fafc;
    border-bottom: 1px solid #e2e8f0;
}

.item-name {
    font-weight: 600;
    color: #2d3748;
    font-size: 15px;
}

.item-badges {
    display: flex;
    gap: 8px;
}

.scheduled-badge, .extra-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 500;
}

.scheduled-badge {
    background: #e3f2fd;
    color: #1976d2;
    border: 1px solid #bbdefb;
}

.extra-badge {
    background: #e2e8f0;
    color: #4a5568;
    border: 1px solid #cbd5e0;
}

.item-details {
    padding: 20px;
}

.detail-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid #f3f4f6;
}

.detail-row:last-child {
    border-bottom: none;
}

.detail-row label {
    color: #64748b;
    font-size: 14px;
    font-weight: 500;
}

.detail-row span {
    color: #1a202c;
    font-weight: 600;
    font-size: 14px;
}

.detail-row.highlight span {
    color: #2563eb;
    font-weight: 700;
}

.detail-row.notes {
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
    padding-top: 16px;
}

.detail-row.notes label {
    color: #4a5568;
    font-weight: 600;
}

.detail-row.notes span {
    color: #4a5568;
    font-weight: normal;
    line-height: 1.6;
}

.no-updates {
    text-align: center;
    padding: 48px 24px;
    color: #718096;
    background: #f8fafc;
    border-radius: 12px;
    border: 1px solid #e2e8f0;
}

.no-updates i {
    font-size: 32px;
        margin-bottom: 16px;
    opacity: 0.5;
}

.no-updates p {
    margin: 0;
    font-size: 15px;
    font-weight: 500;
}

/* Mobile optimizations */
@media (max-width: 768px) {
    .update-selector {
        flex-direction: column;
        padding: 16px;
        gap: 12px;
    }

    .date-picker-container {
        width: 100%;
    }

    .Batch-btn {
        width: 100%;
        justify-content: center;
    }

    .update-header {
        flex-direction: column;
        gap: 16px;
        padding: 16px;
    }

    .update-actions {
        width: 100%;
    }

    .edit-update-btn, .delete-update-btn {
        flex: 1;
        justify-content: center;
    }

    .info-grid {
        grid-template-columns: 1fr;
    }

    .items-grid {
        grid-template-columns: 1fr;
    }

    .item-header {
        padding: 12px 16px;
    }

    .item-details {
        padding: 16px;
    }

    .detail-row {
        padding: 10px 0;
    }
}

/* Enhanced Flatpickr Styles */
.flatpickr-calendar {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    border: 1px solid #e2e8f0;
        padding: 12px;
    width: 350px;
    font-family: inherit;
}

.flatpickr-months {
    padding: 8px 0;
    background: transparent;
}

.flatpickr-month {
    height: 40px;
    background: transparent;
}

.flatpickr-current-month {
    font-size: 14px;
    padding: 8px 0;
    color: #2d3748;
}

.flatpickr-weekday {
    font-size: 13px;
    color: #64748b;
    font-weight: 500;
}

.flatpickr-day {
    border-radius: 6px;
    margin: 2px;
    height: 36px;
    line-height: 36px;
    font-size: 13px;
    color: #2d3748;
    transition: all 0.2s ease;
}

.flatpickr-day.selected {
    background: #4299e1;
    border-color: #4299e1;
    color: white;
    font-weight: 600;
}

.flatpickr-day:hover {
    background: #ebf8ff;
    border-color: #4299e1;
}

.flatpickr-day.today {
    border-color: #4299e1;
    font-weight: 600;
}

.flatpickr-day.disabled {
    color: #cbd5e0;
}

/* Custom markers for schedules and batch start */
.flatpickr-day.has-schedule {
    position: relative;
}

.flatpickr-day.has-schedule::after {
    content: '';
    position: absolute;
    bottom: 4px;
    left: 50%;
    transform: translateX(-50%);
    width: 4px;
    height: 4px;
    background: #4299e1;
    border-radius: 50%;
}

.flatpickr-day.batch-start {
    position: relative;
}

.flatpickr-day.batch-start::before {
    content: '';
    position: absolute;
    top: 4px;
    left: 50%;
    transform: translateX(-50%);
    width: 4px;
    height: 4px;
    background: #48bb78;
    border-radius: 50%;
}

.flatpickr-day.has-schedule.batch-start::after {
    bottom: 2px;
}

.flatpickr-months .flatpickr-prev-month,
.flatpickr-months .flatpickr-next-month {
    top: 8px;
    padding: 4px;
    color: #4299e1;
}

.flatpickr-months .flatpickr-prev-month:hover,
.flatpickr-months .flatpickr-next-month:hover {
    background: #ebf8ff;
    border-radius: 4px;
}

.flatpickr-months .flatpickr-prev-month svg,
.flatpickr-months .flatpickr-next-month svg {
    width: 14px;
    height: 14px;
}

/* Date Picker Container Styles */
.date-picker-container {
    position: relative;
    flex: 1;
}

.date-picker-container input[type="text"] {
    width: 100%;
    padding: 12px 16px;
    padding-right: 40px;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    font-size: 14px;
    color: #2d3748;
    background: white;
    cursor: pointer;
    transition: all 0.2s ease;
}

.date-picker-container input[type="text"]:hover {
    border-color: #4299e1;
}

.date-picker-container input[type="text"]:focus {
    outline: none;
    border-color: #4299e1;
    box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
}

.date-picker-container::after {
    content: '\f073';
    font-family: 'Font Awesome 5 Free';
    font-weight: 900;
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    color: #4299e1;
    pointer-events: none;
}

/* Legend for date markers */
.date-picker-legend {
    display: flex;
    gap: 16px;
    margin-top: 8px;
    padding: 8px 12px;
    background: #f8fafc;
    border-radius: 6px;
    font-size: 12px;
    color: #64748b;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
}

.legend-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
}

.legend-dot.schedule {
    background: #4299e1;
}

.legend-dot.batch-start {
    background: #48bb78;
}

/* Add these styles for the action buttons */
.action-buttons .btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
    border: none;
}

.btn-secondary {
    background: #e2e8f0;
    color: #4a5568;
}

.btn-secondary:hover {
    background: #cbd5e0;
    transform: translateY(-1px);
}

.btn-primary {
    background: #4299e1;
    color: white;
}

.btn-primary:hover {
    background: #3182ce;
    transform: translateY(-1px);
}

.btn-info {
    background: #ebf8ff;
    color: #2b6cb0;
    border: 1px solid #bee3f8;
}

.btn-info:hover {
    background: #bee3f8;
    transform: translateY(-1px);
}

.btn-danger {
    background: #fff5f5;
    color: #c53030;
    border: 1px solid #fed7d7;
}

.btn-danger:hover {
    background: #fed7d7;
    transform: translateY(-1px);
}

/* Mobile optimization for action buttons */
@media (max-width: 768px) {
    .content-header > div {
        flex-direction: column;
        gap: 16px;
    }
    
    .action-buttons {
        width: 100%;
        flex-wrap: wrap;
    }
    
    .action-buttons .btn {
        flex: 1;
        justify-content: center;
        min-width: 120px;
    }
}

/* Add these styles for the fixed footer */
.fixed-footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: white;
    padding: 16px 24px;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
    z-index: 998;
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-left: 280px;
}

.fixed-footer .btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
    border: none;
    min-width: 140px;
    justify-content: center;
}

.btn-secondary {
    background: #e2e8f0;
    color: #4a5568;
}

.btn-secondary:hover {
    background: #cbd5e0;
    transform: translateY(-1px);
}

.btn-primary {
    background: #4299e1;
    color: white;
}

.btn-primary:hover {
    background: #3182ce;
    transform: translateY(-1px);
}

.btn-info {
    background: #ebf8ff;
    color: #2b6cb0;
    border: 1px solid #bee3f8;
}

.btn-info:hover {
    background: #bee3f8;
    transform: translateY(-1px);
}

.btn-danger {
    background: #fff5f5;
    color: #c53030;
    border: 1px solid #fed7d7;
}

.btn-danger:hover {
    background: #fed7d7;
    transform: translateY(-1px);
}

/* Add padding to the bottom of the content to prevent footer overlap */
.content-wrapper {
    padding-bottom: 80px;
}

/* Mobile optimization for fixed footer */
@media (max-width: 768px) {
    .fixed-footer {
        padding: 12px 16px;
        flex-wrap: wrap;
        margin-left: 0;
    }
    
    .fixed-footer .btn {
        flex: 1;
        min-width: 120px;
        padding: 10px 16px;
    }
}

/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 9999; /* Increased z-index to be above everything */
}

.modal-content {
    position: relative;
    background-color: #fff;
    margin: 15% auto;
    padding: 0;
    width: 90%;
    max-width: 500px;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    animation: modalSlideIn 0.3s ease-out;
}

.modal-header {
    padding: 20px;
    border-bottom: 1px solid #e2e8f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h3 {
    margin: 0;
    color: #2d3748;
    font-size: 1.25rem;
}

.close-btn {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: #718096;
    cursor: pointer;
    padding: 0;
    line-height: 1;
}

.modal-body {
    padding: 20px;
}

.status-options {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
}

.status-option {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 16px;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    background: white;
    cursor: pointer;
    transition: all 0.2s ease;
}

.status-option:hover {
    border-color: #4299e1;
    transform: translateY(-2px);
}

.status-option.active {
    border-color: #4299e1;
    background: #ebf8ff;
}

.status-option i {
    font-size: 1.5rem;
    color: #4299e1;
}

.status-option span {
    font-size: 0.9rem;
    font-weight: 500;
    color: #2d3748;
}

.add-btn {
    text-decoration: none;
    max-width: fit-content;
    margin-top: 1.6vh;
}

@keyframes modalSlideIn {
    from {
        transform: translateY(-20px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

/* Mobile optimization for modal */
@media (max-width: 768px) {
    .modal-content {
        margin: 10% auto;
        width: 95%;
    }
    
    .status-options {
        grid-template-columns: 1fr;
    }
}

/* Financial Summary Styles */
.financial-summary {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    padding: 24px;
    margin-bottom: 24px;
}

.financial-summary .section-title {
    color: #2c3e50;
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 2px solid #e9ecef;
}

.financial-summary .info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.financial-summary .info-box {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 16px;
    transition: all 0.3s ease;
}

.financial-summary .info-box:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.financial-summary .info-label {
    color: #6c757d;
    font-size: 0.9rem;
    font-weight: 500;
    margin-bottom: 8px;
}

.financial-summary .info-value {
    color: #2c3e50;
    font-size: 1.25rem;
    font-weight: 600;
}

.financial-summary .highlight {
    background: #e3f2fd;
    border-left: 4px solid #2196f3;
}

.financial-summary .profit {
    background: #e8f5e9;
    border-left: 4px solid #4caf50;
}

.financial-summary .loss {
    background: #ffebee;
    border-left: 4px solid #f44336;
}

.financial-summary .harvest-details {
    display: grid;
    gap: 8px;
    margin-top: 8px;
}

.financial-summary .harvest-details div {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 4px 0;
    border-bottom: 1px solid #e9ecef;
}

.financial-summary .harvest-details div:last-child {
    border-bottom: none;
    font-weight: 600;
    color: #2196f3;
}

.financial-summary .section-subtitle {
    color: #2c3e50;
    font-size: 1.2rem;
    font-weight: 600;
    margin: 24px 0 16px;
    padding-bottom: 8px;
    border-bottom: 1px solid #e9ecef;
}

.financial-summary .alert {
    border-radius: 8px;
    padding: 16px;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 12px;
}

.financial-summary .alert i {
    font-size: 1.25rem;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .financial-summary .info-grid {
        grid-template-columns: 1fr;
    }
    
    .financial-summary {
        padding: 16px;
    }
    
    .financial-summary .info-value {
        font-size: 1.1rem;
    }
}

/* Add these styles for expandable items */
.expandable-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    background: #f8fafc;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.expandable-header:hover {
    background: #edf2f7;
}

.expandable-header .title {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 500;
    color: #2d3748;
}

.expandable-header .title i {
    color: #4299e1;
}

.expandable-header .summary {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 6px;
    color: #4a5568;
    font-size: 0.9em;
}

.expandable-header .summary .item {
    display: flex;
    align-items: center;
    gap: 4px;
}

.expandable-header .summary .item i {
    color: #718096;
    font-size: 0.9em;
}

.expandable-header .expand-icon {
    color: #718096;
    transition: transform 0.2s ease;
}

.expandable-header.expanded .expand-icon {
    transform: rotate(180deg);
}

.expandable-content {
    display: none;
    padding: 16px;
    background: white;
    border-radius: 0 0 8px 8px;
    margin-top: 1px;
}

.expandable-content.show {
    display: block;
}

.expandable-item {
    margin-bottom: 12px;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    overflow: hidden;
}

.expandable-item:last-child {
    margin-bottom: 0;
}

@media (max-width: 768px) {
    .expandable-header {
        flex-direction: column;
    }
}

.quantity-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 4px 8px;
    background: #ebf8ff;
    color: #2b6cb0;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 500;
}
</style>

<div class="content-header">
    <div>
        <h1>Batch Details</h1>
        <div class="breadcrumb">
            <span>Home</span> / <span>Batches</span> / <span>View Batch</span>
        </div>
    </div>
</div>

<div class="section-tabs">
    <div class="section-tab active" onclick="showSection('basic-info')">
        <i class="fas fa-info-circle"></i> Basic Information
    </div>
    <div class="section-tab" onclick="showSection('batch-updates')">
        <i class="fas fa-calendar-alt"></i> Batch Updates
    </div>
    <div class="section-tab" onclick="showSection('financial-summary')">
        <i class="fas fa-chart-line"></i> Financial Summary
    </div>
</div>

<!-- Basic Information Section -->
<div id="basic-info" class="section-content active">
        <div class="info-grid">
            <div class="info-box">
                <div class="info-label">Batch Number</div>
                <div class="info-value">{{ batch.batch_number }}</div>
            </div>
            <div class="info-box">
                <div class="info-label">Farm Batch Number</div>
                <div class="info-value">#{{ batch.farm_batch_number }}</div>
            </div>
            <div class="info-box">
                <div class="info-label">Farm Name</div>
                <div class="info-value">{{ batch.farm.name }}</div>
            </div>
            <div class="info-box">
                <div class="info-label">Age</div>
                <div class="info-value">{{ batch.get_age_days() }} days</div>
            </div>
            <div class="info-box">
                <div class="info-label">Available Birds</div>
                <div class="info-value">{{ batch.available_birds }}</div>
            </div>
            <div class="info-box">
                <div class="info-label">Mortality</div>
                <div class="info-value">{{ batch.total_mortality }}</div>
            </div>
            <div class="info-box">
                <div class="info-label">Feed Used</div>
                <div class="info-value">{{ "%.2f"|format(batch.feed_usage) }} packets</div>
            </div>
            <div class="info-box">
                <div class="info-label">Current Feed Stock</div>
                <div class="info-value">{{ "%.2f"|format(batch.feed_stock) }} packets</div>
            </div>
            <div class="info-box">
                <div class="info-label">Feed Delivered</div>
                <div class="info-value">{{ "%.2f"|format(batch.feed_usage + batch.feed_stock) }}</div>
            </div>
            <div class="info-box">
                <div class="info-label">Manager</div>
                <div class="info-value">
                    {% if batch.manager %}
                        {{ batch.manager.employee.name if batch.manager.employee else batch.manager.username }}
                        <span class="badge {% if batch.manager.user_type == 'senior_manager' %}badge-primary{% else %}badge-secondary{% endif %}">
                            {{ 'Senior Manager' if batch.manager.user_type == 'senior_manager' else 'Assistant Manager' }}
                        </span>
                    {% else %}
                        <span class="text-muted">No manager assigned</span>
                    {% endif %}
                </div>
            </div>
            <div class="info-box">
                <div class="info-label">Status</div>
                <div class="info-value">
                    <span class="status-badge status-{{ batch.status }}">{{ batch.status|title }}</span>
                </div>
            </div>
            <div class="info-box">
                <div class="info-label">Chicks Brand</div>
                <div class="info-value">{{ batch.brand if batch.brand else 'Not specified' }}</div>
            </div>
            <div class="info-box">
                <div class="info-label">Total Birds</div>
                <div class="info-value">{{ batch.total_birds }}</div>
            </div>
            <div class="info-box">
                <div class="info-label">Cost per Chick</div>
                <div class="info-value">₹{{ "%.2f"|format(batch.cost_per_chicken) }}</div>
            </div>
            <div class="info-box">
                <div class="info-label">Created On</div>
                <div class="info-value">{{ batch.created_at.strftime('%Y-%m-%d %H:%M') }}</div>
            </div>
        </div>
    </div>

<!-- Financial Summary Section -->
<div id="financial-summary" class="section-content financial-summary">
    {% if batch.status == 'closed' %}
        <h3 class="section-title">Financial Summary</h3>
        
        <div class="info-grid">
            <div class="info-box highlight">
                <div class="info-label">Total Revenue</div>
                <div class="info-value">₹{{ "%.2f"|format(batch.financial_summary.total_revenue if batch.financial_summary else 0) }}</div>
            </div>
            <div class="info-box highlight">
                <div class="info-label">Total Expenses</div>
                <div class="info-value">₹{{ "%.2f"|format(
                    (batch.financial_summary.total_feed_cost if batch.financial_summary else 0) +
                    (batch.financial_summary.total_medicine_cost if batch.financial_summary else 0) +
                    (batch.financial_summary.total_vaccine_cost if batch.financial_summary else 0) +
                    (batch.financial_summary.total_health_material_cost if batch.financial_summary else 0) +
                    (batch.financial_summary.total_miscellaneous_cost if batch.financial_summary else 0) +
                    (batch.financial_summary.total_bird_cost if batch.financial_summary else 0)
                ) }}</div>
            </div>
            <div class="info-box highlight {% if (batch.financial_summary.total_profit if batch.financial_summary else 0) > 0 %}profit{% else %}loss{% endif %}">
                <div class="info-label">Total Profit/Loss</div>
                <div class="info-value">₹{{ "%.2f"|format(batch.financial_summary.total_profit if batch.financial_summary else 0) }}</div>
            </div>
        </div>

        <h4 class="section-subtitle">Performance Metrics</h4>
        <div class="info-grid">
            <div class="info-box">
                <div class="info-label">FCR (Feed Conversion Ratio)</div>
                <div class="info-value">{{ "%.2f"|format(batch.financial_summary.fcr_value if batch.financial_summary else 0) }}</div>
            </div>
            <div class="info-box">
                <div class="info-label">Mortality Rate</div>
                <div class="info-value">{{ "%.2f"|format((batch.total_mortality / batch.total_birds * 100) if batch.total_birds > 0 else 0) }}%</div>
            </div>
            <div class="info-box">
                <div class="info-label">Total Feed Used</div>
                <div class="info-value">{{ "%.2f"|format(batch.feed_usage) }} packets</div>
            </div>
            <div class="info-box">
                <div class="info-label">Farmer Cost</div>
                <div class="info-value">{{ "%.2f"|format(batch.financial_summary.fcr_price if batch.financial_summary else 0) }} kg</div>
            </div>
            <div class="info-box">
                <div class="info-label">Average Weight</div>
                <div class="info-value">
                    {% if batch.harvests and batch.harvests|sum(attribute='quantity') > 0 %}
                        {{ "%.2f"|format(batch.harvests|sum(attribute='weight') / batch.harvests|sum(attribute='quantity')) }} kg/bird
                    {% else %}
                        -
                    {% endif %}
                </div>
            </div>
        </div>

        <h4 class="section-subtitle">Revenue Breakdown</h4>
        <div class="info-grid">
            {% if batch.harvests %}
                {% for harvest in batch.harvests %}
                <div class="info-box">
                    <div class="info-label">Harvest #{{ loop.index }}</div>
                    <div class="harvest-details">
                        <div>
                            <span>Birds:</span>
                            <span>{{ harvest.birds_count }}</span>
                        </div>
                        <div>
                            <span>Weight:</span>
                            <span>{{ "%.2f"|format(harvest.weight) }} kg</span>
                        </div>
                        <div>
                            <span>Rate:</span>
                            <span>₹{{ "%.2f"|format(harvest.selling_price) }}/kg</span>
                        </div>
                        <div>
                            <span>Total:</span>
                            <span>₹{{ "%.2f"|format(harvest.total_value) }}</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="info-box">
                    <div class="info-label">No Harvests Recorded</div>
                    <div class="info-value">-</div>
                </div>
            {% endif %}
            
        </div>
        <div class="info-box">
            <div class="info-label">Average Rate</div>
            <div class="info-value">
                {% if batch.harvests and batch.harvests|sum(attribute='weight') > 0 %}
                    ₹{{ "%.2f"|format(batch.harvests|sum(attribute='total_value') / batch.harvests|sum(attribute='weight')) }}/kg
                {% else %}
                    -
                {% endif %}
            </div>
        </div>

        <h4 class="section-subtitle">Expense Breakdown</h4>
        <div class="info-grid">
            <div class="info-box">
                <div class="info-label">Chicks Cost</div>
                <div class="info-value">₹{{ "%.2f"|format(batch.financial_summary.total_bird_cost if batch.financial_summary else 0) }}</div>
            </div>
            <div class="info-box">
                <div class="info-label">Feed Cost</div>
                <div class="info-value">₹{{ "%.2f"|format(batch.financial_summary.total_feed_cost if batch.financial_summary else 0) }}</div>
            </div>
            <div class="info-box">
                <div class="info-label">Medicine Cost</div>
                <div class="info-value">₹{{ "%.2f"|format(batch.financial_summary.total_medicine_cost if batch.financial_summary else 0) }}</div>
            </div>
            <div class="info-box">
                <div class="info-label">Health Materials Cost</div>
                <div class="info-value">₹{{ "%.2f"|format(batch.financial_summary.total_health_material_cost if batch.financial_summary else 0) }}</div>
            </div>
            <div class="info-box">
                <div class="info-label">Vaccine Cost</div>
                <div class="info-value">₹{{ "%.2f"|format(batch.financial_summary.total_vaccine_cost if batch.financial_summary else 0) }}</div>
            </div>
            <div class="info-box">
                <div class="info-label">Miscellaneous Cost</div>
                <div class="info-value">₹{{ "%.2f"|format(batch.financial_summary.total_miscellaneous_cost if batch.financial_summary else 0) }}</div>
            </div>
            <div class="info-box">
                <div class="info-label">Farmer Cost</div>
                <div class="info-value">{{ "%.2f"|format(batch.financial_summary.fcr_price if batch.financial_summary else 0) }} kg</div>
            </div>
        </div>

    {% else %}
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i>
            Financial summary will be available after the batch is closed.
        </div>
    {% endif %}
</div>

<!-- Batch Updates Section -->
<div id="batch-updates" class="section-content">
    
    <div class="update-selector">
        <div class="date-picker-container">
            <input type="text" id="updateDate" value="{{ (batch.updates|sort(attribute='date', reverse=true)|first).date|strftime('%Y-%m-%d') if batch.updates else '' }}" readonly>
        </div>
        <button onclick="setToday()" class="Batch-btn">
            <i class="fas fa-calendar-day"></i> Today
        </button>
        <div style="margin-bottom: 16px; text-align: right;">
            <a href="/batches/{{ batch.id }}/update" class="Batch-btn add-btn">
                <i class="fas fa-plus"></i> Add Batch Update
            </a>
        </div>
        <div class="date-picker-legend">
            <div class="legend-item">
                <span class="legend-dot schedule"></span>
                <span>Scheduled</span>
            </div>
            <div class="legend-item">
                <span class="legend-dot batch-start"></span>
                <span>Batch Start</span>
            </div>
        </div>
    </div>
    <div id="updateDetails" class="update-details">
        {% if batch.updates %}
            {% set last_update = batch.updates|sort(attribute='date', reverse=true)|first %}
            <div class="update-header">
                <div class="update-date">
                    <i class="fas fa-calendar"></i>
                    <span>{{ last_update.date.strftime('%Y-%m-%d') }}</span>
                </div>
                <div class="update-actions">
                    <a href="/batches/{{ batch.id }}/update/{{ last_update.date.strftime('%Y-%m-%d') }}/edit" class="edit-update-btn">
                        <i class="fas fa-edit"></i> Edit
                    </a>
                    <button onclick="deleteBatchUpdate('{{ last_update.date.strftime('%Y-%m-%d') }}')" class="delete-update-btn">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            </div>
            <div class="update-content">
                <div class="info-section">
                    <div class="info-section-title">
                        <i class="fas fa-info-circle"></i>
                        Basic Information
                    </div>
                    <div class="info-grid">
                        <div class="info-item">
                            <label>Mortality Count</label>
                            <span>{{ last_update.mortality_count }}</span>
                        </div>
                        <div class="info-item">
                            <label>Feed Used</label>
                            <span>{{ "%.2f"|format(last_update.feed_used) }} packets</span>
                        </div>
                        <div class="info-item">
                            <label>Average Weight</label>
                            <span>{{ "%.2f"|format(last_update.avg_weight) }} kg</span>
                        </div>
                        <div class="info-item">
                            <label>Male Weight</label>
                            <span>{{ "%.2f"|format(last_update.male_weight) }} kg</span>
                        </div>
                        <div class="info-item">
                            <label>Female Weight</label>
                            <span>{{ "%.2f"|format(last_update.female_weight) }} kg</span>
                        </div>
                    </div>
                </div>

                {% if last_update.remarks %}
                <div class="info-section">
                    <div class="info-section-title">
                        <i class="fas fa-sticky-note"></i>
                        Remarks
                        {% if last_update.remarks_priority %}
                        <span class="priority-badge priority-{{ last_update.remarks_priority }}">
                            {{ last_update.remarks_priority|title }}
                        </span>
                        {% endif %}
                    </div>
                    <div class="remarks-content">
                        {{ last_update.remarks }}
                    </div>
                </div>
                {% endif %}

                {% if last_update.feeds %}
                <div class="expandable-item">
                    <div class="expandable-header" onclick="toggleExpandable(this)">
                        <div class="title">
                            <i class="fa-solid fa-seedling"></i>
                            <span>Feeds Used</span>
                        </div>
                        <div class="summary">
                            {% for feed in last_update.feeds %}
                            <div class="item">
                                <i class="fas fa-box"></i>
                                <span>{{ feed.brand }} - {{ feed.category }} ({{ "%.2f"|format(last_update.get_feed_quantity(feed.id)) }} packets)</span>
                            </div>
                            {% endfor %}
                            <i class="fas fa-chevron-down expand-icon"></i>
                        </div>
                    </div>
                    <div class="expandable-content">
                        <div class="items-grid">
                            {% for feed in last_update.feeds %}
                            <div class="item-card feed-card">
                                <div class="item-header">
                                    <span class="item-name">{{ feed.brand }} - {{ feed.category }}</span>
                                    <span class="quantity-badge">
                                        <i class="fas fa-box"></i>
                                        {{ "%.2f"|format(last_update.get_feed_quantity(feed.id)) }} packets
                                    </span>
                                </div>
                                <div class="item-details">
                                    <div class="detail-row">
                                        <label>Quantity Per Unit</label>
                                        <span>{{ "%.2f"|format(last_update.get_feed_quantity_per_unit(feed.id)) }} kg</span>
                                    </div>
                                    <div class="detail-row">
                                        <label>Price at Time</label>
                                        <span>₹{{ "%.2f"|format(last_update.get_feed_price(feed.id)) }}</span>
                                    </div>
                                    <div class="detail-row highlight">
                                        <label>Total Cost</label>
                                        <span>₹{{ "%.2f"|format(last_update.get_feed_quantity(feed.id) * last_update.get_feed_price(feed.id)) }}</span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if last_update.items %}
                {% set medicine_items = last_update.items | selectattr('item_type', 'equalto', 'medicine') | list %}
                {% if medicine_items %}
                <div class="expandable-item">
                    <div class="expandable-header" onclick="toggleExpandable(this)">
                        <div class="title">
                            <i class="fas fa-pills"></i>
                            <span>Medicines</span>
                        </div>
                        <div class="summary">
                            {% for item in medicine_items %}
                            {% set medicine = item.get_item() %}
                            <div class="item">
                                <i class="fas fa-capsules"></i>
                                <span>{{ medicine.name }} ({{ "%.2f"|format(item.quantity) }} units)</span>
                            </div>
                            {% endfor %}
                            <i class="fas fa-chevron-down expand-icon"></i>
                        </div>
                        
                    </div>
                    <div class="expandable-content">
                        <div class="items-grid">
                            {% for item in medicine_items %}
                            {% set medicine = item.get_item() %}
                            <div class="item-card medicine-card">
                                <div class="item-header">
                                    <span class="item-name">{{ medicine.name }}</span>
                                    <span class="quantity-badge">
                                        <i class="fas fa-capsules"></i>
                                        {{ "%.2f"|format(item.quantity) }} units
                                    </span>
                                </div>
                                <div class="item-details">
                                    <div class="detail-row">
                                        <label>Quantity Per Unit</label>
                                        <span>{{ "%.2f"|format(item.quantity_per_unit_at_time) }} {{ item.unit_type }}</span>
                                    </div>
                                    <div class="detail-row">
                                        <label>Price at Time</label>
                                        <span>₹{{ "%.2f"|format(item.price_at_time) }}</span>
                                    </div>
                                    <div class="detail-row highlight">
                                        <label>Total Cost</label>
                                        <span>₹{{ "%.2f"|format(item.total_cost) }}</span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                {% set health_items = last_update.items | selectattr('item_type', 'equalto', 'health_material') | list %}
                {% if health_items %}
                <div class="expandable-item">
                    <div class="expandable-header" onclick="toggleExpandable(this)">
                        <div class="title">
                            <i class="fas fa-medkit"></i>
                            <span>Health Materials</span>
                        </div>
                        <div class="summary">
                            {% for item in health_items %}
                            {% set material = item.get_item() %}
                            <div class="item">
                                <i class="fas fa-box-medical"></i>
                                <span>{{ material.name }} ({{ "%.2f"|format(item.quantity) }} units)</span>
                            </div>
                            {% endfor %}
                            <i class="fas fa-chevron-down expand-icon"></i>
                        </div>
                        
                    </div>
                    <div class="expandable-content">
                        <div class="items-grid">
                            {% for item in health_items %}
                            {% set material = item.get_item() %}
                            <div class="item-card health-material-card">
                                <div class="item-header">
                                    <span class="item-name">{{ material.name }}</span>
                                    <span class="quantity-badge">
                                        <i class="fas fa-box-medical"></i>
                                        {{ "%.2f"|format(item.quantity) }} units
                                    </span>
                                </div>
                                <div class="item-details">
                                    <div class="detail-row">
                                        <label>Quantity Per Unit</label>
                                        <span>{{ "%.2f"|format(item.quantity_per_unit_at_time) }} {{ item.unit_type }}</span>
                                    </div>
                                    <div class="detail-row">
                                        <label>Price at Time</label>
                                        <span>₹{{ "%.2f"|format(item.price_at_time) }}</span>
                                    </div>
                                    <div class="detail-row highlight">
                                        <label>Total Cost</label>
                                        <span>₹{{ "%.2f"|format(item.total_cost) }}</span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                {% set vaccine_items = last_update.items | selectattr('item_type', 'equalto', 'vaccine') | list %}
                {% if vaccine_items %}
                <div class="expandable-item">
                    <div class="expandable-header" onclick="toggleExpandable(this)">
                        <div class="title">
                            <i class="fas fa-syringe"></i>
                            <span>Vaccines</span>
                        </div>
                        <div class="summary">
                            {% for item in vaccine_items %}
                            {% set vaccine = item.get_item() %}
                            <div class="item">
                                <i class="fas fa-syringe"></i>
                                <span>{{ vaccine.name }} ({{ "%.2f"|format(item.quantity) }} units)</span>
                            </div>
                            {% endfor %}
                            <i class="fas fa-chevron-down expand-icon"></i>
                        </div>
                        
                    </div>
                    <div class="expandable-content">
                        <div class="items-grid">
                            {% for item in vaccine_items %}
                            {% set vaccine = item.get_item() %}
                            <div class="item-card vaccine-card">
                                <div class="item-header">
                                    <span class="item-name">{{ vaccine.name }}</span>
                                    <div class="item-badges">
                                        {% if item.schedule_id %}
                                            <span class="scheduled-badge">
                                                <i class="fas fa-calendar-check"></i> Scheduled
                                            </span>
                                        {% else %}
                                            <span class="extra-badge">
                                                <i class="fas fa-plus-circle"></i> Extra
                                            </span>
                                        {% endif %}
                                        <span class="quantity-badge">
                                            <i class="fas fa-syringe"></i>
                                            {{ "%.2f"|format(item.quantity) }} units
                                        </span>
                                    </div>
                                </div>
                                <div class="item-details">
                                    {% if item.schedule_id %}
                                        <div class="detail-row">
                                            <label>Dose Number</label>
                                            <span>{{ item.dose_number }}</span>
                                        </div>
                                    {% endif %}
                                    <div class="detail-row">
                                        <label>Quantity Per Unit</label>
                                        <span>{{ "%.2f"|format(item.quantity_per_unit_at_time) }} {{ item.unit_type }}</span>
                                    </div>
                                    <div class="detail-row">
                                        <label>Price at Time</label>
                                        <span>₹{{ "%.2f"|format(item.price_at_time) }}</span>
                                    </div>
                                    <div class="detail-row highlight">
                                        <label>Total Cost</label>
                                        <span>₹{{ "%.2f"|format(item.total_cost) }}</span>
                                    </div>
                                    {% if item.notes %}
                                        <div class="detail-row notes">
                                            <label>Notes</label>
                                            <span>{{ item.notes }}</span>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}
                {% endif %}

                {% if last_update.miscellaneous_items %}
                <div class="expandable-item">
                    <div class="expandable-header" onclick="toggleExpandable(this)">
                        <div class="title">
                            <i class="fas fa-box-open"></i>
                            <span>Miscellaneous Items</span>
                        </div>
                        <div class="summary">
                            {% for item in last_update.miscellaneous_items %}
                            <div class="item">
                                <i class="fas fa-boxes"></i>
                                <span>{{ item.name }} ({{ "%.2f"|format(item.units_used) }} units)</span>
                            </div>
                            {% endfor %}
                            <i class="fas fa-chevron-down expand-icon"></i>
                        </div>
                        
                    </div>
                    <div class="expandable-content">
                        <div class="items-grid">
                            {% for item in last_update.miscellaneous_items %}
                            <div class="item-card misc-card">
                                <div class="item-header">
                                    <span class="item-name">{{ item.name }}</span>
                                    <span class="quantity-badge">
                                        <i class="fas fa-boxes"></i>
                                        {{ "%.2f"|format(item.units_used) }} units
                                    </span>
                                </div>
                                <div class="item-details">
                                    <div class="detail-row">
                                        <label>Quantity Per Unit</label>
                                        <span>{{ "%.2f"|format(item.quantity_per_unit) }} {{ item.unit_type }}</span>
                                    </div>
                                    <div class="detail-row">
                                        <label>Price at Time</label>
                                        <span>₹{{ "%.2f"|format(item.price_per_unit) }}</span>
                                    </div>
                                    <div class="detail-row highlight">
                                        <label>Total Cost</label>
                                        <span>₹{{ "%.2f"|format(item.total_cost) }}</span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}
                {% if last_update.feed_returns %}
                <div class="expandable-item">
                    <div class="expandable-header" onclick="toggleExpandable(this)">
                        <div class="title">
                            <i class="fas fa-undo"></i>
                            <span>Feed Stock Returns</span>
                        </div>
                        <div class="summary">
                            {% for ret in last_update.feed_returns %}
                            <div class="item">
                                <i class="fas fa-box"></i>
                                <span>{{ ret.feed.brand }} - {{ ret.feed.category }} ({{ "%.2f"|format(ret.quantity) }} packets)</span>
                            </div>
                            {% endfor %}
                            <i class="fas fa-chevron-down expand-icon"></i>
                        </div>
                    </div>
                    <div class="expandable-content">
                        <div class="items-grid">
                            {% for ret in last_update.feed_returns %}
                            <div class="item-card feed-card">
                                <div class="item-header">
                                    <span class="item-name">{{ ret.feed.brand }} - {{ ret.feed.category }}</span>
                                    <span class="quantity-badge">
                                        <i class="fas fa-box"></i>
                                        {{ "%.2f"|format(ret.quantity) }} packets
                                    </span>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        {% else %}
            <div class="no-updates">
                <i class="fas fa-info-circle"></i>
                <p>No updates available for this batch</p>
            </div>
        {% endif %}
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
function showSection(sectionId) {
    // Hide all sections
    document.querySelectorAll('.section-content').forEach(section => {
        section.classList.remove('active');
    });
    
    // Remove active class from all tabs
    document.querySelectorAll('.section-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Show selected section
    document.getElementById(sectionId).classList.add('active');
    
    // Add active class to clicked tab
    event.currentTarget.classList.add('active');
}

// Initialize date picker with improved configuration
document.addEventListener('DOMContentLoaded', function() {
    // Get scheduled dates and batch start date
    const batchStartDate = "{{ batch.created_at.strftime('%Y-%m-%d') }}";
    const scheduledDates = [
        {% for schedule in batch.medicine_schedules %}
            "{{ schedule.schedule_date.strftime('%Y-%m-%d') }}",
        {% endfor %}
        {% for schedule in batch.vaccine_schedules %}
            "{{ schedule.scheduled_date.strftime('%Y-%m-%d') }}",
        {% endfor %}
        {% for schedule in batch.health_material_schedules %}
            "{{ schedule.scheduled_date.strftime('%Y-%m-%d') }}",
        {% endfor %}
    ];

    const datePicker = flatpickr("#updateDate", {
        dateFormat: "Y-m-d",
        maxDate: new Date().toISOString().split('T')[0],
        disableMobile: true,
        allowInput: false,
        clickOpens: true,
        onChange: function(selectedDates, dateStr) {
            fetchBatchUpdate(dateStr);
        },
        onDayCreate: function(dObj, dStr, fp, dayElem) {
            // Get the date in YYYY-MM-DD format
            const date = dayElem.dateObj.getFullYear() + '-' + 
                        String(dayElem.dateObj.getMonth() + 1).padStart(2, '0') + '-' + 
                        String(dayElem.dateObj.getDate()).padStart(2, '0');
            
            // Add batch start marker
            if (date === batchStartDate) {
                dayElem.classList.add('batch-start');
            }
            
            // Add schedule marker
            if (scheduledDates.includes(date)) {
                dayElem.classList.add('has-schedule');
            }
        },
        onOpen: function() {
            // Add custom class to flatpickr calendar
            setTimeout(() => {
                const calendar = document.querySelector('.flatpickr-calendar');
                if (calendar) {
                    calendar.classList.add('custom-flatpickr');
                }
            }, 0);
        }
    });

    // Set initial date if available
    const initialDate = document.getElementById('updateDate').value;
    if (initialDate) {
        datePicker.setDate(initialDate);
    }
});

function setToday() {
    const today = new Date().toISOString().split('T')[0];
    const datePicker = document.querySelector('#updateDate')._flatpickr;
    if (datePicker) {
    datePicker.setDate(today);
        fetchBatchUpdate(today);
    }
}

function fetchBatchUpdate(date) {
    fetch(`/batches/{{ batch.id }}/update/${date}`)
        .then(response => response.json())
        .then(data => {
            if (data.success && data.update) {
                const updateDetails = document.getElementById('updateDetails');
                updateDetails.innerHTML = `
                    <div class="update-header">
                        <div class="update-date">
                            <i class="fas fa-calendar"></i>
                            <span>${date}</span>
                        </div>
                        <div class="update-actions">
                            <a href="/batches/{{ batch.id }}/update/${date}/edit" class="edit-update-btn">
                                <i class="fas fa-edit"></i> Edit
                            </a>
                            <button onclick="deleteBatchUpdate('${date}')" class="delete-update-btn">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                    <div class="update-content">
                        <div class="info-section">
                            <div class="info-section-title">
                                <i class="fas fa-info-circle"></i>
                                Basic Information
                            </div>
                            <div class="info-grid">
                                <div class="info-item">
                                    <label>Mortality Count</label>
                                    <span>${data.update.mortality_count || 0}</span>
                                </div>
                                <div class="info-item">
                                    <label>Feed Used</label>
                                    <span>${parseFloat(data.update.feed_used || 0).toFixed(2)} packets</span>
                                </div>
                                <div class="info-item">
                                    <label>Average Weight</label>
                                    <span>${parseFloat(data.update.avg_weight || 0).toFixed(2)} kg</span>
                                </div>
                                <div class="info-item">
                                    <label>Male Weight</label>
                                    <span>${parseFloat(data.update.male_weight || 0).toFixed(2)} kg</span>
                                </div>
                                <div class="info-item">
                                    <label>Female Weight</label>
                                    <span>${parseFloat(data.update.female_weight || 0).toFixed(2)} kg</span>
                                </div>
                            </div>
                        </div>

                        ${data.update.remarks ? `
                            <div class="info-section">
                                <div class="info-section-title">
                                    <i class="fas fa-sticky-note"></i>
                                    Remarks
                                    ${data.update.remarks_priority ? `
                                        <span class="priority-badge priority-${data.update.remarks_priority}">
                                            ${data.update.remarks_priority.charAt(0).toUpperCase() + data.update.remarks_priority.slice(1)}
                                        </span>
                                    ` : ''}
                                </div>
                                <div class="remarks-content">
                                    ${data.update.remarks}
                                </div>
                            </div>
                        ` : ''}

                        ${data.update.feeds && data.update.feeds.length > 0 ? `
                            <div class="expandable-item">
                                <div class="expandable-header" onclick="toggleExpandable(this)">
                                    <div class="title">
                                        <i class="fa-solid fa-seedling"></i>
                                        <span>Feeds Used</span>
                                    </div>
                                    <div class="summary">
                                        ${data.update.feeds.map(feed => `
                                            <div class="item">
                                                <i class="fas fa-box"></i>
                                                <span>${feed.brand} - ${feed.category} (${feed.quantity.toFixed(2)} packets)</span>
                                            </div>
                                        `).join('')}
                                        <i class="fas fa-chevron-down expand-icon"></i>
                                    </div>
                                    
                                </div>
                                <div class="expandable-content">
                                    <div class="items-grid">
                                        ${data.update.feeds.map(feed => `
                                            <div class="item-card feed-card">
                                                <div class="item-header">
                                                    <span class="item-name">${feed.brand} - ${feed.category}</span>
                                                    <span class="quantity-badge">
                                                        <i class="fas fa-box"></i>
                                                        ${feed.quantity} packets
                                                    </span>
                                                </div>
                                                <div class="item-details">
                                                    <div class="detail-row">
                                                        <label>Quantity Per Unit</label>
                                                        <span>${parseFloat(feed.quantity_per_unit_at_time).toFixed(2)} kg</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <label>Price at Time</label>
                                                        <span>₹${feed.price_at_time.toFixed(2)}</span>
                                                    </div>
                                                    <div class="detail-row highlight">
                                                        <label>Total Cost</label>
                                                        <span>₹${feed.total_cost.toFixed(2)}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        ` : ''}

                        ${data.update.items && data.update.items.length > 0 ? `
                            ${Object.entries(data.update.items.reduce((acc, item) => {
                                if (!acc[item.item_type]) acc[item.item_type] = [];
                                acc[item.item_type].push(item);
                                return acc;
                            }, {})).map(([type, items]) => {
                                const typeConfig = {
                                    medicine: { icon: 'pills', title: 'Medicines', cardClass: 'medicine-card' },
                                    health_material: { icon: 'medkit', title: 'Health Materials', cardClass: 'health-material-card' },
                                    vaccine: { icon: 'syringe', title: 'Vaccines', cardClass: 'vaccine-card' }
                                };
                                const config = typeConfig[type];
                                if (!config) return '';
                                return `
                                    <div class="expandable-item">
                                        <div class="expandable-header" onclick="toggleExpandable(this)">
                                            <div class="title">
                                                <i class="fas fa-${config.icon}"></i>
                                                <span>${config.title}</span>
                                            </div>
                                            <div class="summary">
                                                ${items.map(item => `
                                                    <div class="item">
                                                        <i class="fas fa-capsules"></i>
                                                        <span>${item.name} (${item.quantity.toFixed(2)} units)</span>
                                                    </div>
                                                `).join('')}
                                                <i class="fas fa-chevron-down expand-icon"></i>
                                            </div>
                                            
                                        </div>
                                        <div class="expandable-content">
                                            <div class="items-grid">
                                                ${items.map(item => `
                                                    <div class="item-card medicine-card">
                                                        <div class="item-header">
                                                            <span class="item-name">${item.name}</span>
                                                            <div class="item-badges">
                                                                ${item.schedule_id ? `
                                                                    <span class="scheduled-badge">
                                                                        <i class="fas fa-calendar-check"></i> Scheduled
                                                                    </span>
                                                                ` : `
                                                                    <span class="extra-badge">
                                                                        <i class="fas fa-plus-circle"></i> Extra
                                                                    </span>
                                                                `}
                                                                <span class="quantity-badge">
                                                                    <i class="fas fa-syringe"></i>
                                                                    ${parseFloat(item.quantity).toFixed(2)} units
                                                                </span>
                                                            </div>
                                                            
                                                        </div>
                                                        <div class="item-details">
                                                            <div class="detail-row">
                                                                <label>Quantity Per Unit</label>
                                                                <span>${item.quantity_per_unit_at_time.toFixed(2)} ${item.unit_type}</span>
                                                            </div>
                                                            <div class="detail-row">
                                                                <label>Price at Time</label>
                                                                <span>₹${item.price_at_time.toFixed(2)}</span>
                                                            </div>
                                                            <div class="detail-row highlight">
                                                                <label>Total Cost</label>
                                                                <span>₹${item.total_cost.toFixed(2)}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        ` : ''}

                        ${data.update.miscellaneous_items && data.update.miscellaneous_items.length > 0 ? `
                            <div class="expandable-item">
                                <div class="expandable-header" onclick="toggleExpandable(this)">
                                    <div class="title">
                                        <i class="fas fa-box-open"></i>
                                        <span>Miscellaneous Items</span>
                                    </div>
                                    <div class="summary">
                                        ${data.update.miscellaneous_items.map(item => `
                                            <div class="item">
                                                <i class="fas fa-boxes"></i>
                                                <span>${item.name} (${item.units_used.toFixed(2)} units)</span>
                                            </div>
                                        `).join('')}
                                        <i class="fas fa-chevron-down expand-icon"></i>
                                    </div>
                                    
                                </div>
                                <div class="expandable-content">
                                    <div class="items-grid">
                                        ${data.update.miscellaneous_items.map(item => `
                                            <div class="item-card misc-card">
                                                <div class="item-header">
                                                    <span class="item-name">${item.name}</span>
                                                    <span class="quantity-badge">
                                                        <i class="fas fa-boxes"></i>
                                                        ${item.units_used.toFixed(2)} units
                                                    </span>
                                                </div>
                                                <div class="item-details">
                                                    <div class="detail-row">
                                                        <label>Quantity Per Unit</label>
                                                        <span>${item.quantity_per_unit.toFixed(2)} ${item.unit_type}</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <label>Price at Time</label>
                                                        <span>₹${item.price_per_unit.toFixed(2)}</span>
                                                    </div>
                                                    <div class="detail-row highlight">
                                                        <label>Total Cost</label>
                                                        <span>₹${item.total_cost.toFixed(2)}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                        ${data.update.feed_returns && data.update.feed_returns.length > 0 ? `
                            <div class="expandable-item">
                                <div class="expandable-header" onclick="toggleExpandable(this)">
                                    <div class="title">
                                        <i class="fas fa-undo"></i>
                                        <span>Feed Stock Returns</span>
                                    </div>
                                    <div class="summary">
                                        ${data.update.feed_returns.map(ret => `
                                            <div class="item">
                                                <i class="fas fa-box"></i>
                                                <span>${ret.feed.brand} - ${ret.feed.category} (${ret.quantity.toFixed(2)} packets)</span>
                                            </div>
                                        `).join('')}
                                        <i class="fas fa-chevron-down expand-icon"></i>
                                    </div>
                                </div>
                                <div class="expandable-content">
                                    <div class="items-grid">
                                        ${data.update.feed_returns.map(ret => `
                                            <div class="item-card feed-card">
                                                <div class="item-header">
                                                    <span class="item-name">${ret.feed.brand} - ${ret.feed.category}</span>
                                                    <span class="quantity-badge">
                                                        <i class="fas fa-box"></i>
                                                        ${ret.quantity.toFixed(2)} packets
                                                    </span>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            } else {
                document.getElementById('updateDetails').innerHTML = `
                    <div class="no-updates">
                        <i class="fas fa-info-circle"></i>
                        <p>No update found for this date.</p>
                    </div>`;
            }
        })
        .catch(error => {
            console.error('Error:', error);
            document.getElementById('updateDetails').innerHTML = `
                <div class="no-updates">
                    <i class="fas fa-exclamation-circle"></i>
                    <p>Error loading update: ${error.message}</p>
                </div>`;
        });
}

function deleteBatchUpdate(date) {
    if (confirm('Are you sure you want to delete this update?')) {
        fetch(`/batches/{{ batch.id }}/update/${date}/delete`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                window.location.reload();
            } else {
                alert('Error deleting update: ' + data.error);
}
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error deleting update');
        });
    }
}

// Update the changeBatchStatus function
function changeBatchStatus() {
    const modal = document.getElementById('statusModal');
    modal.style.display = 'block';
    document.body.style.overflow = 'hidden'; // Prevent background scrolling
}

function closeStatusModal() {
    const modal = document.getElementById('statusModal');
    modal.style.display = 'none';
    document.body.style.overflow = ''; // Restore scrolling
}

function updateStatus(newStatus) {
    if (confirm(`Are you sure you want to change the batch status to ${newStatus}?`)) {
        fetch(`/batches/{{ batch.id }}/update-status`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
            },
            body: JSON.stringify({ status: newStatus })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                window.location.reload();
            } else {
                alert('Error changing status: ' + (data.error || 'Unknown error'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error changing status');
        });
    }
}

function deleteBatch() {
    if (confirm('Are you sure you want to delete this batch? This action cannot be undone.')) {
        fetch(`/batches/{{ batch.id }}/delete`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                window.location.href = '/batches';
            } else {
                alert('Error deleting batch: ' + (data.error || 'Unknown error'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error deleting batch');
        });
    }
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('statusModal');
    if (event.target == modal) {
        closeStatusModal();
    }
}

// Update the fixed footer buttons
document.querySelector('.fixed-footer').innerHTML = `
    <a href="/batches" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Back
    </a>
    
    <button onclick="changeBatchStatus()" class="btn btn-primary">
        <i class="fas fa-exchange-alt"></i> Change Status
    </button>
    
    <a href="/batches/edit/{{ batch.id }}" class="btn btn-info">
        <i class="fas fa-edit"></i> Edit
    </a>
    <button onclick="deleteBatch()" class="btn btn-danger">
        <i class="fas fa-trash"></i> Delete
    </button>
`;

function toggleExpandable(header) {
    const content = header.nextElementSibling;
    const isExpanded = header.classList.contains('expanded');
    
    // Toggle the expanded class
    header.classList.toggle('expanded');
    
    // Toggle the content visibility
    if (isExpanded) {
        content.classList.remove('show');
    } else {
        content.classList.add('show');
    }
}

// Add this to your existing JavaScript
document.addEventListener('DOMContentLoaded', function() {
    // Initialize all expandable sections as collapsed
    document.querySelectorAll('.expandable-header').forEach(header => {
        const content = header.nextElementSibling;
        content.classList.remove('show');
        header.classList.remove('expanded');
    });
});

// Update the showBatchUpdate function
function showBatchUpdate(update) {
    const updateContent = document.getElementById('updateContent');
    if (!update) {
        updateContent.innerHTML = '<div class="no-update">No update available for this date</div>';
        return;
    }

    let html = `
        <div class="info-section">
            <div class="info-section-title">
                <i class="fas fa-info-circle"></i>
                Basic Information
            </div>
            <div class="info-grid">
                <div class="info-item">
                    <label>Mortality Count</label>
                    <span>${update.mortality_count}</span>
                </div>
                <div class="info-item">
                    <label>Feed Used</label>
                    <span>${parseFloat(update.feed_used).toFixed(2)} packets</span>
                </div>
                <div class="info-item">
                    <label>Average Weight</label>
                    <span>${parseFloat(update.avg_weight).toFixed(2)} kg</span>
                </div>
                <div class="info-item">
                    <label>Male Weight</label>
                    <span>${parseFloat(update.male_weight).toFixed(2)} kg</span>
                </div>
                <div class="info-item">
                    <label>Female Weight</label>
                    <span>${parseFloat(update.female_weight).toFixed(2)} kg</span>
                </div>
            </div>
        </div>
    `;

    if (update.remarks) {
        html += `
            <div class="info-section">
                <div class="info-section-title">
                    <i class="fas fa-sticky-note"></i>
                    Remarks
                    ${update.remarks_priority ? `
                        <span class="priority-badge priority-${update.remarks_priority}">
                            ${update.remarks_priority.charAt(0).toUpperCase() + update.remarks_priority.slice(1)}
                        </span>
                    ` : ''}
                </div>
                <div class="remarks-content">
                    ${update.remarks}
                </div>
            </div>
        `;
    }

    if (update.feeds && update.feeds.length > 0) {
        html += `
            <div class="expandable-item">
                <div class="expandable-header" onclick="toggleExpandable(this)">
                    <div class="title">
                        <i class="fa-solid fa-seedling"></i>
                        <span>Feeds Used</span>
                    </div>
                    <div class="summary">
                        ${update.feeds.map(feed => `
                            <div class="item">
                                <i class="fas fa-box"></i>
                                <span>${feed.brand} - ${feed.category} (${parseFloat(feed.quantity).toFixed(2)} packets)</span>
                            </div>
                        `).join('')}
                    </div>
                    <i class="fas fa-chevron-down expand-icon"></i>
                </div>
                <div class="expandable-content">
                    <div class="items-grid">
                        ${update.feeds.map(feed => `
                            <div class="item-card feed-card">
                                <div class="item-header">
                                    <span class="item-name">${feed.brand} - ${feed.category}</span>
                                    <span class="quantity-badge">
                                        <i class="fas fa-box"></i>
                                        ${parseFloat(feed.quantity).toFixed(2)} packets
                                    </span>
                                </div>
                                <div class="item-details">
                                    <div class="detail-row">
                                        <label>Quantity Per Unit</label>
                                        <span>${parseFloat(feed.quantity_per_unit_at_time).toFixed(2)} kg</span>
                                    </div>
                                    <div class="detail-row">
                                        <label>Price at Time</label>
                                        <span>₹${parseFloat(feed.price_at_time).toFixed(2)}</span>
                                    </div>
                                    <div class="detail-row highlight">
                                        <label>Total Cost</label>
                                        <span>₹${(parseFloat(feed.quantity) * parseFloat(feed.price_at_time)).toFixed(2)}</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
        `;
    }

    if (update.items && update.items.length > 0) {
        const medicines = update.items.filter(item => item.item_type === 'medicine');
        if (medicines.length > 0) {
            html += `
                <div class="expandable-item">
                    <div class="expandable-header" onclick="toggleExpandable(this)">
                        <div class="title">
                            <i class="fas fa-pills"></i>
                            <span>Medicines</span>
                        </div>
                        <div class="summary">
                            ${medicines.map(item => `
                                <div class="item">
                                    <i class="fas fa-capsules"></i>
                                    <span>${item.name} (${parseFloat(item.quantity).toFixed(2)} units)</span>
                                </div>
                            `).join('')}
                        </div>
                        <i class="fas fa-chevron-down expand-icon"></i>
                    </div>
                    <div class="expandable-content">
                        <div class="items-grid">
                            ${medicines.map(item => `
                                <div class="item-card medicine-card">
                                    <div class="item-header">
                                        <span class="item-name">${item.name}</span>
                                        <span class="quantity-badge">
                                            <i class="fas fa-capsules"></i>
                                            ${parseFloat(item.quantity).toFixed(2)} units
                                        </span>
                                    </div>
                                    <div class="item-details">
                                        <div class="detail-row">
                                            <label>Quantity Per Unit</label>
                                            <span>${parseFloat(item.quantity_per_unit_at_time).toFixed(2)} ${item.unit_type}</span>
                                        </div>
                                        <div class="detail-row">
                                            <label>Price at Time</label>
                                            <span>₹${parseFloat(item.price_at_time).toFixed(2)}</span>
                                        </div>
                                        <div class="detail-row highlight">
                                            <label>Total Cost</label>
                                            <span>₹${parseFloat(item.total_cost).toFixed(2)}</span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        const healthMaterials = update.items.filter(item => item.item_type === 'health_material');
        if (healthMaterials.length > 0) {
            html += `
                <div class="expandable-item">
                    <div class="expandable-header" onclick="toggleExpandable(this)">
                        <div class="title">
                            <i class="fas fa-medkit"></i>
                            <span>Health Materials</span>
                        </div>
                        <div class="summary">
                            ${healthMaterials.map(item => `
                                <div class="item">
                                    <i class="fas fa-box-medical"></i>
                                    <span>${item.name} (${parseFloat(item.quantity).toFixed(2)} units)</span>
                                </div>
                            `).join('')}
                        </div>
                        <i class="fas fa-chevron-down expand-icon"></i>
                    </div>
                    <div class="expandable-content">
                        <div class="items-grid">
                            ${healthMaterials.map(item => `
                                <div class="item-card health-material-card">
                                    <div class="item-header">
                                        <span class="item-name">${item.name}</span>
                                        <span class="quantity-badge">
                                            <i class="fas fa-box-medical"></i>
                                            ${parseFloat(item.quantity).toFixed(2)} units
                                        </span>
                                    </div>
                                    <div class="item-details">
                                        <div class="detail-row">
                                            <label>Quantity Per Unit</label>
                                            <span>${parseFloat(item.quantity_per_unit_at_time).toFixed(2)} ${item.unit_type}</span>
                                        </div>
                                        <div class="detail-row">
                                            <label>Price at Time</label>
                                            <span>₹${parseFloat(item.price_at_time).toFixed(2)}</span>
                                        </div>
                                        <div class="detail-row highlight">
                                            <label>Total Cost</label>
                                            <span>₹${parseFloat(item.total_cost).toFixed(2)}</span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        const vaccines = update.items.filter(item => item.item_type === 'vaccine');
        if (vaccines.length > 0) {
            html += `
                <div class="expandable-item">
                    <div class="expandable-header" onclick="toggleExpandable(this)">
                        <div class="title">
                            <i class="fas fa-syringe"></i>
                            <span>Vaccines</span>
                        </div>
                        <div class="summary">
                            ${vaccines.map(item => `
                                <div class="item">
                                    <i class="fas fa-syringe"></i>
                                    <span>${item.name} (${parseFloat(item.quantity).toFixed(2)} units)</span>
                                </div>
                            `).join('')}
                        </div>
                        <i class="fas fa-chevron-down expand-icon"></i>
                    </div>
                    <div class="expandable-content">
                        <div class="items-grid">
                            ${vaccines.map(item => `
                                <div class="item-card vaccine-card">
                                    <div class="item-header">
                                        <span class="item-name">${item.name}</span>
                                        <div class="item-badges">
                                            ${item.schedule_id ? `
                                                <span class="scheduled-badge">
                                                    <i class="fas fa-calendar-check"></i> Scheduled
                                                </span>
                                            ` : `
                                                <span class="extra-badge">
                                                    <i class="fas fa-plus-circle"></i> Extra
                                                </span>
                                            `}
                                            <span class="quantity-badge">
                                                <i class="fas fa-syringe"></i>
                                                ${parseFloat(item.quantity).toFixed(2)} units
                                            </span>
                                        </div>
                                    </div>
                                    <div class="item-details">
                                        ${item.schedule_id ? `
                                            <div class="detail-row">
                                                <label>Dose Number</label>
                                                <span>${item.dose_number}</span>
                                            </div>
                                        ` : ''}
                                        <div class="detail-row">
                                            <label>Quantity Per Unit</label>
                                            <span>${parseFloat(item.quantity_per_unit_at_time).toFixed(2)} ${item.unit_type}</span>
                                        </div>
                                        <div class="detail-row">
                                            <label>Price at Time</label>
                                            <span>₹${parseFloat(item.price_at_time).toFixed(2)}</span>
                                        </div>
                                        <div class="detail-row highlight">
                                            <label>Total Cost</label>
                                            <span>₹${parseFloat(item.total_cost).toFixed(2)}</span>
                                        </div>
                                        ${item.notes ? `
                                            <div class="detail-row notes">
                                                <label>Notes</label>
                                                <span>${item.notes}</span>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }
    }

    if (update.miscellaneous_items && update.miscellaneous_items.length > 0) {
        html += `
            <div class="expandable-item">
                <div class="expandable-header" onclick="toggleExpandable(this)">
                    <div class="title">
                        <i class="fas fa-box-open"></i>
                        <span>Miscellaneous Items</span>
                    </div>
                    <div class="summary">
                        ${update.miscellaneous_items.map(item => `
                            <div class="item">
                                <i class="fas fa-boxes"></i>
                                <span>${item.name} (${parseFloat(item.units_used).toFixed(2)} units)</span>
                            </div>
                        `).join('')}
                    </div>
                    <i class="fas fa-chevron-down expand-icon"></i>
                </div>
                <div class="expandable-content">
                    <div class="items-grid">
                        ${update.miscellaneous_items.map(item => `
                            <div class="item-card misc-card">
                                <div class="item-header">
                                    <span class="item-name">${item.name}</span>
                                    <span class="quantity-badge">
                                        <i class="fas fa-boxes"></i>
                                        ${parseFloat(item.units_used).toFixed(2)} units
                                    </span>
                                </div>
                                <div class="item-details">
                                    <div class="detail-row">
                                        <label>Quantity Per Unit</label>
                                        <span>${parseFloat(item.quantity_per_unit).toFixed(2)} ${item.unit_type}</span>
                                    </div>
                                    <div class="detail-row">
                                        <label>Price at Time</label>
                                        <span>₹${parseFloat(item.price_per_unit).toFixed(2)}</span>
                                    </div>
                                    <div class="detail-row highlight">
                                        <label>Total Cost</label>
                                        <span>₹${parseFloat(item.total_cost).toFixed(2)}</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
        `;
    }

    updateContent.innerHTML = html;
}
</script>

<!-- Add this at the end of the content, before the closing body tag -->
<div class="fixed-footer">
    <a href="/batches" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Back
    </a>
    
    <button onclick="changeBatchStatus()" class="btn btn-primary">
        <i class="fas fa-exchange-alt"></i> Change Status
    </button>
    
    <a href="/batches/edit/{{ batch.id }}" class="btn btn-info">
        <i class="fas fa-edit"></i> Edit
    </a>
    <button onclick="deleteBatch()" class="btn btn-danger">
        <i class="fas fa-trash"></i> Delete
    </button>
</div>

<!-- Wrap the main content in a div with padding-bottom -->
<div class="content-wrapper">

<!-- Status Modal -->
<div id="statusModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Change Batch Status</h3>
            <button onclick="closeStatusModal()" class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
            <div class="status-options">
                <button onclick="updateStatus('ongoing')" class="status-option {% if batch.status == 'ongoing' %}active{% endif %}">
                    <i class="fas fa-clock"></i>
                    <span>Ongoing</span>
                </button>
                <button onclick="updateStatus('closing')" class="status-option {% if batch.status == 'closing' %}active{% endif %}">
                    <i class="fas fa-hourglass-half"></i>
                    <span>Closing</span>
                </button>
                <button onclick="updateStatus('closed')" class="status-option {% if batch.status == 'closed' %}active{% endif %}">
                    <i class="fas fa-check-circle"></i>
                    <span>Closed</span>
                </button>
            </div>
        </div>
    </div>
</div>

{% endblock %} 